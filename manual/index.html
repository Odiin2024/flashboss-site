<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlashBoss Manual</title>
    <link rel="stylesheet" href="style.css?v=4">
    <link rel="icon" type="image/png" href="../icon.png">
    <style>
        /* Manual wrapper */
        .manual-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 3vh 8vw;
            box-sizing: border-box;
        }

        /* Header bar */
        .manual-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .back-link {
            font-size: 0.8rem;
            color: var(--link-blue);
            text-decoration: none;
            transition: color 0.2s;
            cursor: pointer;
        }

        .back-link:hover {
            color: #ffffff;
        }

        .back-link.disabled {
            color: var(--grey);
            cursor: default;
            pointer-events: none;
        }

        .view-toggle {
            background: rgba(10, 10, 25, 0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 102, 255, 0.2);
            border-radius: 4px;
            color: var(--grey);
            padding: 0.3rem 0.75rem;
            cursor: pointer;
            transition: border-color 0.2s, color 0.2s;
            font-size: 0.75rem;
        }

        .view-toggle:hover {
            border-color: rgba(255, 102, 255, 0.4);
            color: var(--moon-cream);
        }

        /* Main content area - frosted glass */
        .manual-content {
            flex: 1;
            background: rgba(10, 10, 25, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 8px;
            border: 1px solid rgba(255, 102, 255, 0.2);
            box-shadow:
                0 0 20px rgba(255, 102, 255, 0.3),
                0 0 40px rgba(255, 102, 255, 0.15),
                0 0 60px rgba(126, 200, 255, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Content header */
        .content-header {
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(255, 102, 255, 0.15);
            text-align: center;
        }

        .content-title {
            font-family: var(--font-pixel);
            font-size: 0.9rem;
            color: var(--moon-cream);
            margin: 0;
        }

        /* Main grid: image left, details right */
        .content-main {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            padding: 1.5rem 2rem;
            overflow-y: auto;
        }

        /* Left side: parents + image + children */
        .content-left {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Parent buttons - blue for going back */
        .parents-row {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .parent-btn {
            background: #171421;
            border: 1px solid var(--link-blue);
            border-radius: 4px;
            padding: 0.4rem 0.75rem;
            color: var(--link-blue);
            font-size: 0.8rem;
            cursor: pointer;
            transition: border-color 0.2s, box-shadow 0.2s, color 0.2s;
            text-decoration: none;
        }

        .parent-btn:hover {
            border-color: var(--link-blue);
            box-shadow: 0 0 10px rgba(126, 200, 255, 0.4);
            color: #ffffff;
        }

        .focus-image-link {
            display: block;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .focus-image-link:hover {
            transform: scale(1.02);
        }

        .focus-image-link:hover .focus-image {
            border-color: rgba(255, 102, 255, 0.5);
            box-shadow: 0 0 20px rgba(255, 102, 255, 0.4), 0 0 35px rgba(255, 102, 255, 0.2);
        }

        .focus-image {
            width: 100%;
            max-width: 350px;
            border-radius: 6px;
            border: 1px solid rgba(255, 102, 255, 0.2);
            box-shadow: 0 0 10px rgba(255, 102, 255, 0.15);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .focus-placeholder {
            width: 100%;
            max-width: 350px;
            aspect-ratio: 16/9;
            background: rgba(10, 10, 25, 0.5);
            border-radius: 6px;
            border: 1px solid rgba(255, 102, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--grey);
            font-size: 0.9rem;
        }

        .learn-more-link {
            display: inline-block;
            background: rgba(126, 200, 255, 0.15);
            border: 1px solid var(--link-blue);
            border-radius: 4px;
            padding: 0.5rem 1rem;
            color: var(--link-blue);
            text-decoration: none;
            font-size: 0.85rem;
            transition: background 0.2s, box-shadow 0.2s;
            margin-top: 0.5rem;
        }

        .learn-more-link:hover {
            background: rgba(126, 200, 255, 0.25);
            box-shadow: 0 0 10px rgba(126, 200, 255, 0.3);
            color: #ffffff;
        }

        /* Children navigation */
        .children-section {
            margin-top: 1rem;
        }

        .children-title {
            font-size: 0.8rem;
            color: var(--grey);
            margin-bottom: 0.75rem;
            font-style: italic;
        }

        .children-list {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .child-item {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            cursor: pointer;
            text-decoration: none;
        }

        .child-item:hover .child-num-box {
            border-color: rgba(255, 102, 255, 0.7);
            box-shadow: 0 0 10px rgba(255, 102, 255, 0.4);
        }

        .child-item:hover .child-num {
            text-shadow: 0 0 8px rgba(255, 102, 255, 0.6);
        }

        .child-num-box {
            background: #171421;
            border: 1px solid var(--grey);
            border-radius: 3px;
            padding: 0.3rem 0.5rem;
            min-width: 2rem;
            text-align: center;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .child-num {
            font-family: var(--font-pixel);
            font-size: 0.5rem;
            color: #ff66ff;
            line-height: 1.4;
            white-space: pre-line;
            transition: text-shadow 0.2s;
        }

        .child-title {
            font-size: 0.8rem;
            color: var(--moon-cream);
        }

        /* Right side: description */
        .content-right {
            display: flex;
            flex-direction: column;
            padding: 0 5%;
        }

        .description-text {
            color: var(--moon-cream);
            line-height: 1.8;
        }

        .description-text p {
            margin-bottom: 1rem;
        }

        /* Footer */
        .content-footer {
            padding: 1rem 2rem;
            border-top: 1px solid rgba(255, 102, 255, 0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-left {
            font-size: 0.8rem;
            color: var(--grey);
            font-style: italic;
        }

        .footer-right {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .footer-link {
            font-size: 0.8rem;
            color: var(--link-blue);
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-link:hover {
            color: #ffffff;
        }

        .footer-divider {
            color: var(--grey);
        }

        /* Tile view */
        .tile-view {
            flex: 1;
            background: rgba(10, 10, 25, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 8px;
            border: 1px solid rgba(255, 102, 255, 0.2);
            box-shadow:
                0 0 20px rgba(255, 102, 255, 0.3),
                0 0 40px rgba(255, 102, 255, 0.15);
            display: grid;
            grid-template-columns: 1fr 1fr;
            overflow: hidden;
        }

        .tile-page {
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
        }

        .tile-page-left {
            border-right: 1px solid rgba(255, 102, 255, 0.15);
        }

        .tile-page-title {
            font-size: 0.85rem;
            color: var(--grey);
            text-align: center;
            margin-bottom: 1rem;
            font-style: italic;
        }

        .tile-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            flex: 1;
        }

        .tile {
            background: #171421;
            border: 1px solid rgba(255, 102, 255, 0.3);
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            cursor: pointer;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .tile:hover {
            border-color: rgba(255, 102, 255, 0.6);
            box-shadow: 0 0 15px rgba(255, 102, 255, 0.3);
        }

        .tile-title {
            font-family: var(--font-pixel);
            font-size: 0.55rem;
            color: var(--moon-cream);
            text-align: center;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .tile-desc {
            font-size: 0.75rem;
            color: var(--grey);
            text-align: center;
        }

        /* Hidden state */
        .hidden {
            display: none !important;
        }

        /* Mobile */
        @media (max-width: 768px) {
            .manual-wrapper {
                padding: 2vh 4vw;
            }

            .content-main {
                grid-template-columns: 1fr;
                padding: 1rem;
            }

            .tile-view {
                grid-template-columns: 1fr;
            }

            .tile-page-left {
                border-right: none;
                border-bottom: 1px solid rgba(255, 102, 255, 0.15);
            }

            .content-footer {
                flex-direction: column;
                gap: 0.75rem;
                text-align: center;
            }

            .view-toggle {
                font-size: 0.65rem;
                padding: 0.25rem 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="manual-wrapper">
        <!-- Header -->
        <div class="manual-header">
            <a class="back-link disabled" id="backLink">Back to previous screen</a>
            <button class="view-toggle" id="viewToggle">Change to Tile View</button>
        </div>

        <!-- Main content - Grimoire view (default) -->
        <div class="manual-content" id="grimoireView">
            <div class="content-header">
                <h1 class="content-title" id="screenTitle">Loading...</h1>
            </div>

            <div class="content-main">
                <div class="content-left">
                    <div class="parents-row" id="parentsRow"></div>

                    <a class="focus-image-link" id="focusLink" href="#">
                        <img class="focus-image" id="focusImage" src="" alt="">
                    </a>
                    <div id="learnMoreArea"></div>

                    <div class="children-section" id="childrenSection">
                        <p class="children-title">Navigate to:</p>
                        <div class="children-list" id="childrenList"></div>
                    </div>
                </div>

                <div class="content-right">
                    <div class="description-text" id="descriptionText"></div>
                </div>
            </div>

            <div class="content-footer">
                <span class="footer-left">Click the image or a number to navigate</span>
                <div class="footer-right">
                    <a href="../beta-key.html" class="footer-link">Ready for a Beta Key?</a>
                    <span class="footer-divider">&middot;</span>
                    <a href="../home.html" class="footer-link">Hub</a>
                    <span class="footer-divider">&middot;</span>
                    <a href="https://store.steampowered.com/app/4134440/FlashBoss/" class="footer-link">Visit Steam</a>
                </div>
            </div>
        </div>

        <!-- Tile view -->
        <div class="tile-view hidden" id="tileView">
            <div class="tile-page tile-page-left">
                <p class="tile-page-title">How to Play</p>
                <div class="tile-grid">
                    <div class="tile" onclick="selectTopic('profile-select')">
                        <span class="tile-title">Getting Started</span>
                        <span class="tile-desc">Installation & setup</span>
                    </div>
                    <div class="tile" onclick="selectTopic('tier-skip')">
                        <span class="tile-title">Tier Skip</span>
                        <span class="tile-desc">Test out of content</span>
                    </div>
                    <div class="tile" onclick="selectTopic('sanctum')">
                        <span class="tile-title">Daily Practice</span>
                        <span class="tile-desc">Streaks & reviews</span>
                    </div>
                    <div class="tile" onclick="selectTopic('sanctum')">
                        <span class="tile-title">Boss Fights</span>
                        <span class="tile-desc">Challenge clusters</span>
                    </div>
                    <div class="tile" onclick="selectTopic('sanctum')">
                        <span class="tile-title">Grimoire</span>
                        <span class="tile-desc">Powerdrive & Drive</span>
                    </div>
                    <div class="tile" onclick="selectTopic('sanctum')">
                        <span class="tile-title">Review Modes</span>
                        <span class="tile-desc">Practice options</span>
                    </div>
                </div>
            </div>
            <div class="tile-page">
                <p class="tile-page-title">About FlashBoss</p>
                <div class="tile-grid">
                    <div class="tile" onclick="selectTopic('create-master')">
                        <span class="tile-title">Masters</span>
                        <span class="tile-desc">Choose your guide</span>
                    </div>
                    <div class="tile" onclick="selectTopic('lesson-pack-select')">
                        <span class="tile-title">Lessons</span>
                        <span class="tile-desc">Learn new words</span>
                    </div>
                    <div class="tile" onclick="selectTopic('profile-data')">
                        <span class="tile-title">Tiers</span>
                        <span class="tile-desc">Progression system</span>
                    </div>
                    <div class="tile" onclick="selectTopic('create-pack')">
                        <span class="tile-title">Language Packs</span>
                        <span class="tile-desc">German, Esperanto</span>
                    </div>
                    <div class="tile" onclick="selectTopic('terminal')">
                        <span class="tile-title">Terminal</span>
                        <span class="tile-desc">CLI commands</span>
                    </div>
                    <div class="tile" onclick="selectTopic('about-1')">
                        <span class="tile-title">FAQ</span>
                        <span class="tile-desc">Common questions</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let screens = {};
        let currentFocus = 'entrance';
        let focusHistory = [];
        let isGrimoireView = true;

        // Toggle between grimoire and tile view
        function setView(showGrimoire) {
            isGrimoireView = showGrimoire;
            document.getElementById('grimoireView').classList.toggle('hidden', !isGrimoireView);
            document.getElementById('tileView').classList.toggle('hidden', isGrimoireView);
            document.getElementById('viewToggle').textContent = isGrimoireView ? 'Change to Tile View' : 'Change to Grimoire View';
        }

        document.getElementById('viewToggle').addEventListener('click', () => {
            setView(!isGrimoireView);
        });

        // Select topic from tile view
        function selectTopic(screenId) {
            if (screens[screenId]) {
                focusHistory.push(currentFocus);
                currentFocus = screenId;
                renderScreen();
                setView(true);
            }
        }

        // Load screen data
        fetch('screens.json')
            .then(response => response.json())
            .then(data => {
                screens = data;

                // Check for URL parameter
                const urlParams = new URLSearchParams(window.location.search);
                const screenParam = urlParams.get('screen');
                if (screenParam && screens[screenParam]) {
                    currentFocus = screenParam;
                }

                renderScreen();
            })
            .catch(err => {
                console.error('Failed to load screens.json:', err);
                document.getElementById('screenTitle').textContent = 'Error loading data';
            });

        function renderScreen() {
            const focus = screens[currentFocus];
            if (!focus) return;

            // Update back link - goes to first parent (default back path)
            const backLink = document.getElementById('backLink');
            if (focus.parents && focus.parents.length > 0) {
                const firstParent = screens[focus.parents[0]];
                if (firstParent) {
                    backLink.classList.remove('disabled');
                    backLink.textContent = 'Back to ' + firstParent.title;
                    backLink.onclick = () => setFocus(focus.parents[0]);
                } else {
                    backLink.classList.add('disabled');
                    backLink.textContent = 'Back';
                    backLink.onclick = null;
                }
            } else {
                backLink.classList.add('disabled');
                backLink.textContent = 'Back';
                backLink.onclick = null;
            }

            // Render parent buttons (blue)
            const parentsRow = document.getElementById('parentsRow');
            parentsRow.innerHTML = '';
            if (focus.parents && focus.parents.length > 0) {
                focus.parents.forEach(parentId => {
                    const parent = screens[parentId];
                    if (!parent) return;

                    const btn = document.createElement('a');
                    btn.className = 'parent-btn';
                    btn.textContent = '← ' + parent.title;
                    btn.onclick = () => setFocus(parentId);
                    parentsRow.appendChild(btn);
                });
            }

            // Title
            document.getElementById('screenTitle').textContent = focus.title;

            // Image
            const focusImage = document.getElementById('focusImage');
            const focusLink = document.getElementById('focusLink');
            if (focus.image) {
                focusImage.src = focus.image;
                focusImage.alt = focus.title;
                focusImage.style.display = 'block';
            } else {
                focusImage.style.display = 'none';
            }

            // Focus link - goes to dedicated page if exists
            if (focus.page) {
                focusLink.href = focus.page;
                focusLink.onclick = null;
            } else {
                focusLink.href = '#';
                focusLink.onclick = (e) => e.preventDefault();
            }

            // Learn more link
            const learnMoreArea = document.getElementById('learnMoreArea');
            if (focus.page) {
                learnMoreArea.innerHTML = `<a href="${focus.page}" class="learn-more-link">Learn more →</a>`;
            } else {
                learnMoreArea.innerHTML = '';
            }

            // Description
            const descDiv = document.getElementById('descriptionText');
            descDiv.innerHTML = '';
            focus.description.split('\n\n').forEach(para => {
                const p = document.createElement('p');
                p.textContent = para;
                descDiv.appendChild(p);
            });

            // Children
            const childrenSection = document.getElementById('childrenSection');
            const childrenList = document.getElementById('childrenList');
            childrenList.innerHTML = '';

            if (focus.children.length > 0) {
                childrenSection.style.display = 'block';

                focus.children.forEach(childId => {
                    const child = screens[childId];
                    if (!child) return;

                    const menuNum = focus.childLabels ? (focus.childLabels[childId] || '') : '';

                    // Expand ranges like "2-5" to multi-line
                    let displayNum = menuNum;
                    const rangeMatch = menuNum.match(/^(\d+)-(\d+)$/);
                    if (rangeMatch) {
                        const start = parseInt(rangeMatch[1]);
                        const end = parseInt(rangeMatch[2]);
                        const nums = [];
                        for (let i = start; i <= end; i++) {
                            nums.push(i);
                        }
                        displayNum = nums.join('\n');
                    }

                    const item = document.createElement('div');
                    item.className = 'child-item';
                    item.onclick = () => setFocus(childId);

                    item.innerHTML = `
                        <div class="child-num-box">
                            <span class="child-num">${displayNum}</span>
                        </div>
                        <span class="child-title">${child.title}</span>
                    `;
                    childrenList.appendChild(item);
                });
            } else {
                childrenSection.style.display = 'none';
            }
        }

        function setFocus(screenId) {
            if (screens[screenId]) {
                focusHistory.push(currentFocus);
                currentFocus = screenId;
                renderScreen();
            }
        }

        function goBack() {
            if (focusHistory.length > 0) {
                currentFocus = focusHistory.pop();
                renderScreen();
            }
        }
    </script>
</body>
</html>
