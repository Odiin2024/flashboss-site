<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlashBoss Manual</title>
    <link rel="stylesheet" href="style.css?v=5">
    <link rel="icon" type="image/png" href="../icon.png">
    <style>
        /* Manual wrapper */
        .manual-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 3vh 8vw;
            box-sizing: border-box;
        }

        /* Top bar */
        .top-bar {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 0.5rem;
        }

        .view-toggle {
            background: rgba(10, 10, 25, 0.5);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 102, 255, 0.2);
            border-radius: 4px;
            color: var(--grey);
            padding: 0.3rem 0.75rem;
            cursor: pointer;
            transition: border-color 0.2s, color 0.2s;
            font-size: 0.75rem;
        }

        .view-toggle:hover {
            border-color: rgba(255, 102, 255, 0.4);
            color: var(--moon-cream);
        }

        /* Main content panel - frosted glass */
        .manual-panel {
            flex: 1;
            background: rgba(10, 10, 25, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 8px;
            border: 1px solid rgba(255, 102, 255, 0.2);
            box-shadow:
                0 0 20px rgba(255, 102, 255, 0.3),
                0 0 40px rgba(255, 102, 255, 0.15),
                0 0 60px rgba(126, 200, 255, 0.1);
            display: grid;
            grid-template-columns: 1fr 1fr;
            overflow: hidden;
        }

        /* Left column */
        .panel-left {
            display: flex;
            flex-direction: column;
        }

        .left-header {
            padding: 1rem 1.5rem 1rem 2.5rem;
        }

        .screen-title {
            font-family: var(--font-pixel);
            font-size: 0.85rem;
            color: var(--moon-cream);
            margin: 0;
        }

        .left-content {
            flex: 1;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 1rem 1.5rem;
        }

        .focus-image-link {
            display: block;
            text-decoration: none;
            transition: transform 0.2s;
        }

        .focus-image-link:hover {
            transform: scale(1.02);
        }

        .focus-image-link:hover .focus-image {
            border-color: rgba(255, 102, 255, 0.5);
            box-shadow: 0 0 20px rgba(255, 102, 255, 0.4), 0 0 35px rgba(255, 102, 255, 0.2);
        }

        .focus-image {
            max-width: 100%;
            max-height: 66vh;
            border-radius: 6px;
            border: 1px solid rgba(255, 102, 255, 0.3);
            box-shadow: 0 0 10px rgba(255, 102, 255, 0.2);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .focus-placeholder {
            width: 300px;
            height: 200px;
            background: rgba(10, 10, 25, 0.5);
            border-radius: 6px;
            border: 1px solid rgba(255, 102, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--grey);
            font-size: 0.9rem;
        }

        .left-footer {
            padding: 1rem 1.5rem;
            font-size: 0.8rem;
            color: var(--grey);
            font-style: italic;
            text-align: center;
        }

        /* Right column */
        .panel-right {
            display: flex;
            flex-direction: column;
        }

        .right-header {
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: flex-end;
        }

        .back-btn {
            background: #171421;
            border: 1px solid var(--grey);
            border-radius: 4px;
            padding: 0.4rem 0.75rem;
            color: var(--grey);
            font-size: 0.8rem;
            cursor: pointer;
            transition: border-color 0.2s, color 0.2s, box-shadow 0.2s;
            text-decoration: none;
        }

        .back-btn:hover {
            border-color: var(--link-blue);
            color: var(--link-blue);
            box-shadow: 0 0 8px rgba(126, 200, 255, 0.3);
        }

        .back-btn.disabled {
            opacity: 0.4;
            cursor: default;
            pointer-events: none;
        }

        .right-content {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
        }

        .description-text {
            color: var(--moon-cream);
            line-height: 1.8;
            margin-bottom: 1.5rem;
        }

        .description-text p {
            margin-bottom: 1rem;
        }

        /* Navigate to section */
        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-title {
            font-size: 0.85rem;
            color: var(--grey);
            margin-bottom: 0.75rem;
            font-style: italic;
        }

        .nav-list {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        /* Parent buttons - grey/blue */
        .nav-parent {
            display: flex;
            align-items: center;
            background: #171421;
            border: 1px solid var(--grey);
            border-radius: 4px;
            padding: 0.5rem 0.75rem;
            color: var(--link-blue);
            font-size: 0.85rem;
            cursor: pointer;
            transition: border-color 0.2s, box-shadow 0.2s;
            text-decoration: none;
        }

        .nav-parent:hover {
            border-color: var(--link-blue);
            box-shadow: 0 0 10px rgba(126, 200, 255, 0.4);
        }

        /* Child buttons - grey/magenta with numbers */
        .nav-child {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: #171421;
            border: 1px solid var(--grey);
            border-radius: 4px;
            padding: 0.5rem 0.75rem;
            cursor: pointer;
            transition: border-color 0.2s, box-shadow 0.2s;
            text-decoration: none;
        }

        .nav-child:hover {
            border-color: rgba(255, 102, 255, 0.7);
            box-shadow: 0 0 10px rgba(255, 102, 255, 0.4);
        }

        .nav-child:hover .child-num {
            text-shadow: 0 0 8px rgba(255, 102, 255, 0.6);
        }

        .child-num {
            font-family: var(--font-pixel);
            font-size: 0.5rem;
            color: #ff66ff;
            min-width: 1.5rem;
            line-height: 1.4;
            white-space: pre-line;
            transition: text-shadow 0.2s;
        }

        .child-title {
            font-size: 0.85rem;
            color: var(--moon-cream);
        }

        /* Learn more link */
        .learn-more-link {
            display: inline-block;
            background: rgba(126, 200, 255, 0.15);
            border: 1px solid var(--link-blue);
            border-radius: 4px;
            padding: 0.5rem 1rem;
            color: var(--link-blue);
            text-decoration: none;
            font-size: 0.85rem;
            transition: background 0.2s, box-shadow 0.2s;
        }

        .learn-more-link:hover {
            background: rgba(126, 200, 255, 0.25);
            box-shadow: 0 0 10px rgba(126, 200, 255, 0.3);
            color: #ffffff;
        }

        .right-footer {
            padding: 1rem 1.5rem;
            display: flex;
            gap: 0.5rem;
            align-items: center;
            justify-content: center;
        }

        .footer-link {
            font-size: 0.8rem;
            color: var(--link-blue);
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-link:hover {
            color: #ffffff;
        }

        .footer-divider {
            color: var(--grey);
        }

        /* Tile view */
        .tile-view {
            flex: 1;
            background: rgba(10, 10, 25, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 8px;
            border: 1px solid rgba(255, 102, 255, 0.2);
            box-shadow:
                0 0 20px rgba(255, 102, 255, 0.3),
                0 0 40px rgba(255, 102, 255, 0.15);
            display: grid;
            grid-template-columns: 1fr 1fr;
            overflow: hidden;
        }

        .tile-page {
            display: flex;
            flex-direction: column;
            padding: 1.5rem;
        }

        .tile-page-left {
        }

        .tile-page-title {
            font-size: 0.85rem;
            color: var(--grey);
            text-align: center;
            margin-bottom: 1rem;
            font-style: italic;
        }

        .tile-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            flex: 1;
        }

        .tile {
            background: #171421;
            border: 1px solid rgba(255, 102, 255, 0.3);
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            cursor: pointer;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .tile:hover {
            border-color: rgba(255, 102, 255, 0.6);
            box-shadow: 0 0 15px rgba(255, 102, 255, 0.3);
        }

        .tile-title {
            font-family: var(--font-pixel);
            font-size: 0.55rem;
            color: var(--moon-cream);
            text-align: center;
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .tile-desc {
            font-size: 0.75rem;
            color: var(--grey);
            text-align: center;
        }

        /* Hidden state */
        .hidden {
            display: none !important;
        }

        /* Mobile */
        @media (max-width: 768px) {
            .manual-wrapper {
                padding: 2vh 4vw;
            }

            .manual-panel {
                grid-template-columns: 1fr;
            }

            .panel-left {
            }

            .tile-view {
                grid-template-columns: 1fr;
            }

            .tile-page-left {
            }

            .view-toggle {
                font-size: 0.65rem;
                padding: 0.25rem 0.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="manual-wrapper">
        <!-- Top bar -->
        <div class="top-bar">
            <button class="view-toggle" id="viewToggle">Change to Tile View</button>
        </div>

        <!-- Main panel - Grimoire view (default) -->
        <div class="manual-panel" id="grimoireView">
            <!-- Left column -->
            <div class="panel-left">
                <div class="left-header">
                    <h1 class="screen-title" id="screenTitle">Loading...</h1>
                </div>
                <div class="left-content">
                    <a class="focus-image-link" id="focusLink" href="#">
                        <img class="focus-image" id="focusImage" src="" alt="">
                    </a>
                </div>
                <div class="left-footer" id="leftFooter">
                    Click image for more information
                </div>
            </div>

            <!-- Right column -->
            <div class="panel-right">
                <div class="right-header">
                    <a class="back-btn disabled" id="backBtn">Back</a>
                </div>
                <div class="right-content">
                    <div class="description-text" id="descriptionText"></div>

                    <div class="nav-section" id="navSection">
                        <p class="nav-title">Navigate to:</p>
                        <div class="nav-list" id="navList"></div>
                    </div>

                    <div id="learnMoreArea"></div>
                </div>
                <div class="right-footer">
                    <a href="../beta-key.html" class="footer-link">Ready for a Beta Key?</a>
                    <span class="footer-divider">·</span>
                    <a href="../home.html" class="footer-link">Hub</a>
                    <span class="footer-divider">·</span>
                    <a href="https://store.steampowered.com/app/4134440/FlashBoss/" class="footer-link">Visit Steam</a>
                </div>
            </div>
        </div>

        <!-- Tile view -->
        <div class="tile-view hidden" id="tileView">
            <div class="tile-page tile-page-left">
                <p class="tile-page-title">How to Play</p>
                <div class="tile-grid">
                    <div class="tile" onclick="selectTopic('profile-select')">
                        <span class="tile-title">Getting Started</span>
                        <span class="tile-desc">Installation & setup</span>
                    </div>
                    <div class="tile" onclick="selectTopic('tier-skip')">
                        <span class="tile-title">Tier Skip</span>
                        <span class="tile-desc">Test out of content</span>
                    </div>
                    <div class="tile" onclick="selectTopic('sanctum')">
                        <span class="tile-title">Daily Practice</span>
                        <span class="tile-desc">Streaks & reviews</span>
                    </div>
                    <div class="tile" onclick="selectTopic('sanctum')">
                        <span class="tile-title">Boss Fights</span>
                        <span class="tile-desc">Challenge clusters</span>
                    </div>
                    <div class="tile" onclick="selectTopic('sanctum')">
                        <span class="tile-title">Grimoire</span>
                        <span class="tile-desc">Powerdrive & Drive</span>
                    </div>
                    <div class="tile" onclick="selectTopic('sanctum')">
                        <span class="tile-title">Review Modes</span>
                        <span class="tile-desc">Practice options</span>
                    </div>
                </div>
            </div>
            <div class="tile-page">
                <p class="tile-page-title">About FlashBoss</p>
                <div class="tile-grid">
                    <div class="tile" onclick="selectTopic('create-master')">
                        <span class="tile-title">Masters</span>
                        <span class="tile-desc">Choose your guide</span>
                    </div>
                    <div class="tile" onclick="selectTopic('lesson-pack-select')">
                        <span class="tile-title">Lessons</span>
                        <span class="tile-desc">Learn new words</span>
                    </div>
                    <div class="tile" onclick="selectTopic('profile-data')">
                        <span class="tile-title">Tiers</span>
                        <span class="tile-desc">Progression system</span>
                    </div>
                    <div class="tile" onclick="selectTopic('create-pack')">
                        <span class="tile-title">Language Packs</span>
                        <span class="tile-desc">German, Esperanto</span>
                    </div>
                    <div class="tile" onclick="selectTopic('terminal')">
                        <span class="tile-title">Terminal</span>
                        <span class="tile-desc">CLI commands</span>
                    </div>
                    <div class="tile" onclick="selectTopic('about-1')">
                        <span class="tile-title">FAQ</span>
                        <span class="tile-desc">Common questions</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let screens = {};
        let currentFocus = 'entrance';
        let isGrimoireView = true;

        // Toggle views
        function setView(showGrimoire) {
            isGrimoireView = showGrimoire;
            document.getElementById('grimoireView').classList.toggle('hidden', !isGrimoireView);
            document.getElementById('tileView').classList.toggle('hidden', isGrimoireView);
            document.getElementById('viewToggle').textContent = isGrimoireView ? 'Change to Tile View' : 'Change to Grimoire View';
        }

        document.getElementById('viewToggle').addEventListener('click', () => {
            setView(!isGrimoireView);
        });

        // Select from tile view
        function selectTopic(screenId) {
            if (screens[screenId]) {
                currentFocus = screenId;
                renderScreen();
                setView(true);
            }
        }

        // Load screens
        fetch('screens.json')
            .then(response => response.json())
            .then(data => {
                screens = data;

                const urlParams = new URLSearchParams(window.location.search);
                const screenParam = urlParams.get('screen');
                if (screenParam && screens[screenParam]) {
                    currentFocus = screenParam;
                }

                renderScreen();
            })
            .catch(err => {
                console.error('Failed to load screens.json:', err);
                document.getElementById('screenTitle').textContent = 'Error loading data';
            });

        function renderScreen() {
            const focus = screens[currentFocus];
            if (!focus) return;

            // Title
            document.getElementById('screenTitle').textContent = focus.title;

            // Image
            const focusImage = document.getElementById('focusImage');
            const focusLink = document.getElementById('focusLink');
            if (focus.image) {
                focusImage.src = focus.image;
                focusImage.alt = focus.title;
                focusImage.style.display = 'block';
            } else {
                focusImage.style.display = 'none';
            }

            // Image link - goes to dedicated page
            if (focus.page) {
                focusLink.href = focus.page;
                focusLink.onclick = null;
            } else {
                focusLink.href = '#';
                focusLink.onclick = (e) => e.preventDefault();
            }

            // Left footer - update based on whether page exists
            const leftFooter = document.getElementById('leftFooter');
            if (focus.page) {
                leftFooter.textContent = 'Click image for more information';
            } else {
                leftFooter.textContent = '';
            }

            // Back button - goes to primary parent
            const backBtn = document.getElementById('backBtn');
            if (focus.parents && focus.parents.length > 0) {
                const firstParent = screens[focus.parents[0]];
                if (firstParent) {
                    backBtn.classList.remove('disabled');
                    backBtn.textContent = 'Back';
                    backBtn.onclick = () => {
                        currentFocus = focus.parents[0];
                        renderScreen();
                    };
                } else {
                    backBtn.classList.add('disabled');
                }
            } else {
                backBtn.classList.add('disabled');
            }

            // Description
            const descDiv = document.getElementById('descriptionText');
            descDiv.innerHTML = '';
            focus.description.split('\n\n').forEach(para => {
                const p = document.createElement('p');
                p.textContent = para;
                descDiv.appendChild(p);
            });

            // Navigation list - parents then children
            const navSection = document.getElementById('navSection');
            const navList = document.getElementById('navList');
            navList.innerHTML = '';

            const hasParents = focus.parents && focus.parents.length > 0;
            const hasChildren = focus.children && focus.children.length > 0;

            if (hasParents || hasChildren) {
                navSection.style.display = 'block';

                // Parents first (blue)
                if (hasParents) {
                    focus.parents.forEach(parentId => {
                        const parent = screens[parentId];
                        if (!parent) return;

                        const item = document.createElement('a');
                        item.className = 'nav-parent';
                        item.textContent = '← ' + parent.title;
                        item.onclick = () => {
                            currentFocus = parentId;
                            renderScreen();
                        };
                        navList.appendChild(item);
                    });
                }

                // Children (magenta with numbers)
                if (hasChildren) {
                    focus.children.forEach(childId => {
                        const child = screens[childId];
                        if (!child) return;

                        const menuNum = focus.childLabels ? (focus.childLabels[childId] || '') : '';

                        // Expand ranges
                        let displayNum = menuNum;
                        const rangeMatch = menuNum.match(/^(\d+)-(\d+)$/);
                        if (rangeMatch) {
                            const start = parseInt(rangeMatch[1]);
                            const end = parseInt(rangeMatch[2]);
                            const nums = [];
                            for (let i = start; i <= end; i++) {
                                nums.push(i);
                            }
                            displayNum = nums.join('\n');
                        }

                        const item = document.createElement('a');
                        item.className = 'nav-child';
                        item.innerHTML = `
                            <span class="child-num">${displayNum}</span>
                            <span class="child-title">${child.title}</span>
                        `;
                        item.onclick = () => {
                            currentFocus = childId;
                            renderScreen();
                        };
                        navList.appendChild(item);
                    });
                }
            } else {
                navSection.style.display = 'none';
            }

            // Learn more link
            const learnMoreArea = document.getElementById('learnMoreArea');
            if (focus.page) {
                learnMoreArea.innerHTML = `<a href="${focus.page}" class="learn-more-link">Learn more →</a>`;
            } else {
                learnMoreArea.innerHTML = '';
            }
        }
    </script>
</body>
</html>
